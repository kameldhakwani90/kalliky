#!/usr/bin/env npx tsx

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// Configuration des 10 m√©tiers de base
const businessCategories = [
  {
    category: 'RESTAURANT',
    displayName: 'Restaurant / Food',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Sois direct et efficace.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, adresse si livraison
‚è∞ LIMITE: Conclure commande rapidement  
üéØ FOCUS: Commande ‚Üí Confirmation ‚Üí Raccrocher
‚ùå √âVITER: Discussions longues hors commande

SP√âCIALIT√âS:
- Prendre commandes avec pr√©cision
- G√©rer livraisons et retraits
- Proposer boissons et accompagnements
- Demander pr√©f√©rences (√©pic√©, allergies)
- Calculer temps de pr√©paration`,
    defaultParams: {
      deliveryRadius: 5,
      minimumOrder: 15,
      deliveryFee: 3,
      freeDeliveryThreshold: 25,
      preparationTime: 25,
      acceptsDelivery: true,
      acceptsPickup: true
    },
    availableOptions: [
      { key: 'suggestDrinks', label: 'Proposer boissons automatiquement', type: 'boolean' },
      { key: 'suggestDesserts', label: 'Sugg√©rer desserts si commande >20‚Ç¨', type: 'boolean' },
      { key: 'askSpiceLevel', label: 'Demander niveau √©pic√©', type: 'boolean' },
      { key: 'handleAllergies', label: 'G√©rer allergies alimentaires', type: 'boolean' },
      { key: 'offerPaymentOnDelivery', label: 'Proposer paiement √† la livraison', type: 'boolean' }
    ]
  },
  {
    category: 'BEAUTY',
    displayName: 'Salon de Beaut√©',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Va √† l'essentiel.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, type prestation
‚è∞ LIMITE: Fixer RDV rapidement  
üéØ FOCUS: Besoin ‚Üí Cr√©neau ‚Üí Confirmation
‚ùå √âVITER: Conseils d√©taill√©s (RDV pour √ßa)

SP√âCIALIT√âS:
- R√©server prestations beaut√©
- Informer sur dur√©es et tarifs
- Proposer soins compl√©mentaires
- G√©rer contre-indications (grossesse)
- Sugg√©rer packages attractifs`,
    defaultParams: {
      appointmentDuration: 90,
      advanceBooking: 24,
      cancellationPolicy: 24,
      specialistRequired: false,
      packageDeals: true
    },
    availableOptions: [
      { key: 'askHairLength', label: 'Demander longueur cheveux actuels', type: 'boolean' },
      { key: 'suggestColors', label: 'Proposer couleurs tendances', type: 'boolean' },
      { key: 'upsellTreatments', label: 'Proposer soins compl√©mentaires', type: 'boolean' },
      { key: 'checkPregnancy', label: 'V√©rifier grossesse (produits)', type: 'boolean' },
      { key: 'loyaltyProgram', label: 'Informer programme fid√©lit√©', type: 'boolean' }
    ]
  },
  {
    category: 'AUTOMOTIVE',
    displayName: 'Garage Automobile',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Efficacit√© max.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, v√©hicule, probl√®me
‚è∞ LIMITE: Diagnostiquer et planifier vite
üéØ FOCUS: Sympt√¥mes ‚Üí Urgence ‚Üí RDV
‚ùå √âVITER: Explications techniques longues

SP√âCIALIT√âS:
- Diagnostiquer probl√®mes v√©hicules
- √âvaluer urgence interventions
- Planifier rendez-vous atelier
- Proposer v√©hicule de courtoisie
- Informer sur d√©lais et tarifs`,
    defaultParams: {
      interventionTime: 120,
      courtyesyCarAvailable: true,
      quoteRequired: 200,
      emergencyService: true,
      specializedBrands: [],
      workingHours: '8h-18h'
    },
    availableOptions: [
      { key: 'askVehicleDetails', label: 'Demander marque/mod√®le/ann√©e pr√©cis', type: 'boolean' },
      { key: 'describeSymptoms', label: 'Faire d√©crire sympt√¥mes d√©taill√©s', type: 'boolean' },
      { key: 'checkHistory', label: 'V√©rifier historique entretien', type: 'boolean' },
      { key: 'offerCourtesyCar', label: 'Proposer v√©hicule de courtoisie', type: 'boolean' },
      { key: 'mandatoryQuote', label: 'Devis obligatoire avant intervention', type: 'boolean' }
    ]
  },
  {
    category: 'MEDICAL',
    displayName: 'Cabinet M√©dical',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Pr√©cision m√©dicale.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, motif consultation
‚è∞ LIMITE: √âvaluer et programmer vite
üéØ FOCUS: Sympt√¥mes ‚Üí Urgence ‚Üí RDV
‚ùå √âVITER: Conseils m√©dicaux (r√©serv√© au m√©decin)

SP√âCIALIT√âS:
- √âvaluer urgence consultations
- Planifier rendez-vous appropri√©s
- Orienter selon sp√©cialit√©s
- G√©rer t√©l√©consultations
- Respecter confidentialit√© stricte`,
    defaultParams: {
      consultationDuration: 30,
      emergencySlots: true,
      teleconsultation: true,
      pediatricAge: 16,
      homeVisits: false,
      specialties: []
    },
    availableOptions: [
      { key: 'collectSecuNumber', label: 'Demander num√©ro s√©curit√© sociale', type: 'boolean' },
      { key: 'askCurrentTreatments', label: 'V√©rifier traitements en cours', type: 'boolean' },
      { key: 'describeSymptoms', label: 'Faire d√©crire sympt√¥mes principaux', type: 'boolean' },
      { key: 'checkAge', label: 'V√©rifier √¢ge patient (p√©diatrie)', type: 'boolean' },
      { key: 'offerTeleconsult', label: 'Proposer t√©l√©consultation si appropri√©', type: 'boolean' }
    ]
  },
  {
    category: 'LEGAL',
    displayName: 'Cabinet Juridique',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Confidentialit√© absolue.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, domaine juridique
‚è∞ LIMITE: Qualifier demande rapidement
üéØ FOCUS: Probl√©matique ‚Üí Sp√©cialit√© ‚Üí RDV
‚ùå √âVITER: Conseils juridiques (r√©serv√© √† l'avocat)

SP√âCIALIT√âS:
- Qualifier demandes juridiques
- Orienter selon sp√©cialit√©s
- Planifier consultations
- Informer sur tarifs
- Assurer confidentialit√© totale`,
    defaultParams: {
      consultationDuration: 60,
      freeFirstConsult: 30,
      specialties: ['famille', 'immobilier'],
      averageProcessTime: 90,
      confidentiality: true
    },
    availableOptions: [
      { key: 'identifyLegalField', label: 'Identifier domaine juridique pr√©cis', type: 'boolean' },
      { key: 'collectDocuments', label: 'Lister documents n√©cessaires', type: 'boolean' },
      { key: 'estimateTimeline', label: 'Estimer d√©lais proc√©dure', type: 'boolean' },
      { key: 'mentionPartners', label: 'Informer sur partenaires (experts)', type: 'boolean' },
      { key: 'remindConfidentiality', label: 'Rappeler confidentialit√©', type: 'boolean' }
    ]
  },
  {
    category: 'RETAIL',
    displayName: 'Commerce de D√©tail',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Service client efficace.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, produit recherch√©
‚è∞ LIMITE: Informer et vendre vite
üéØ FOCUS: Besoin ‚Üí Disponibilit√© ‚Üí Commande/R√©servation
‚ùå √âVITER: Descriptions produits longues

SP√âCIALIT√âS:
- V√©rifier disponibilit√© stock
- Informer sur promotions
- G√©rer click & collect
- Proposer alternatives
- Fid√©liser clients`,
    defaultParams: {
      stockCheck: true,
      clickAndCollect: true,
      homeDelivery: false,
      loyaltyProgram: true,
      promotionsActive: true
    },
    availableOptions: [
      { key: 'checkStock', label: 'V√©rifier disponibilit√© en temps r√©el', type: 'boolean' },
      { key: 'suggestAlternatives', label: 'Proposer produits similaires', type: 'boolean' },
      { key: 'mentionPromotions', label: 'Informer sur promotions en cours', type: 'boolean' },
      { key: 'offerClickCollect', label: 'Proposer click & collect', type: 'boolean' },
      { key: 'loyaltyPoints', label: 'G√©rer points fid√©lit√©', type: 'boolean' }
    ]
  },
  {
    category: 'IMMOBILIER',
    displayName: 'Agence Immobili√®re',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Efficacit√© commerciale.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, type bien, budget
‚è∞ LIMITE: Qualifier rapidement
üéØ FOCUS: Crit√®res ‚Üí Disponibilit√©s ‚Üí Visite
‚ùå √âVITER: Descriptions d√©taill√©es (visite pour √ßa)

SP√âCIALIT√âS:
- Qualifier demandes immobili√®res
- Proposer biens correspondants
- Planifier visites
- Informer sur financement
- G√©rer n√©gociations`,
    defaultParams: {
      geographicZone: [],
      propertyTypes: ['appartement', 'maison'],
      averageCommission: 3,
      virtualVisits: true,
      financingHelp: true
    },
    availableOptions: [
      { key: 'collectBudget', label: 'Demander budget pr√©cis', type: 'boolean' },
      { key: 'askCriteria', label: 'Lister crit√®res d√©taill√©s', type: 'boolean' },
      { key: 'checkFinancing', label: 'V√©rifier capacit√© financement', type: 'boolean' },
      { key: 'offerVirtualVisit', label: 'Proposer visite virtuelle', type: 'boolean' },
      { key: 'mentionFees', label: 'Informer sur honoraires', type: 'boolean' }
    ]
  },
  {
    category: 'EDUCATION',
    displayName: 'Formation / Cours',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Orientation p√©dagogique.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, formation souhait√©e, niveau
‚è∞ LIMITE: Orienter rapidement
üéØ FOCUS: Objectifs ‚Üí Programme ‚Üí Inscription
‚ùå √âVITER: D√©tails p√©dagogiques longs

SP√âCIALIT√âS:
- √âvaluer niveau et objectifs
- Orienter vers formations adapt√©es
- Informer sur modalit√©s
- Planifier tests/entretiens
- G√©rer inscriptions`,
    defaultParams: {
      levelAssessment: true,
      groupOrIndividual: 'both',
      certificationAvailable: true,
      onlineOption: true,
      averageCourseDuration: 10
    },
    availableOptions: [
      { key: 'assessLevel', label: '√âvaluer niveau actuel', type: 'boolean' },
      { key: 'defineObjectives', label: 'D√©finir objectifs formation', type: 'boolean' },
      { key: 'explainProgram', label: 'Expliquer programme bri√®vement', type: 'boolean' },
      { key: 'mentionCertification', label: 'Informer sur certification', type: 'boolean' },
      { key: 'scheduleInterview', label: 'Planifier entretien orientation', type: 'boolean' }
    ]
  },
  {
    category: 'TRANSPORT',
    displayName: 'Transport / Livraison',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Logistique rapide.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, origine, destination, type colis
‚è∞ LIMITE: Planifier transport vite
üéØ FOCUS: Trajets ‚Üí D√©lais ‚Üí R√©servation
‚ùå √âVITER: Explications logistiques complexes

SP√âCIALIT√âS:
- Calculer trajets et d√©lais
- G√©rer r√©servations transport
- Informer sur tarifs
- Assurer suivi envois
- G√©rer urgences`,
    defaultParams: {
      serviceZones: [],
      vehicleTypes: ['utilitaire', 'camion'],
      trackingAvailable: true,
      insuranceIncluded: true,
      urgentService: true
    },
    availableOptions: [
      { key: 'calculateDistance', label: 'Calculer distance et temps', type: 'boolean' },
      { key: 'checkPackageSize', label: 'V√©rifier dimensions colis', type: 'boolean' },
      { key: 'offerInsurance', label: 'Proposer assurance transport', type: 'boolean' },
      { key: 'provideTracking', label: 'Fournir suivi temps r√©el', type: 'boolean' },
      { key: 'handleFragile', label: 'G√©rer objets fragiles', type: 'boolean' }
    ]
  },
  {
    category: 'FITNESS',
    displayName: 'Sport / Fitness',
    systemPrompt: `Tu as MAX 3 MINUTES par appel. Motivation sportive.
‚úÖ OBLIGATOIRE: Nom, t√©l√©phone, objectifs fitness, niveau
‚è∞ LIMITE: Orienter programme vite
üéØ FOCUS: Objectifs ‚Üí Programme ‚Üí Inscription
‚ùå √âVITER: Conseils sportifs d√©taill√©s

SP√âCIALIT√âS:
- √âvaluer condition physique
- Orienter vers programmes adapt√©s
- Planifier s√©ances d√©couverte
- G√©rer abonnements
- Motiver et fid√©liser`,
    defaultParams: {
      fitnessLevels: ['d√©butant', 'interm√©diaire', 'avanc√©'],
      personalTrainer: true,
      groupClasses: true,
      nutritionAdvice: false,
      healthAssessment: true
    },
    availableOptions: [
      { key: 'assessFitnessLevel', label: '√âvaluer niveau sportif', type: 'boolean' },
      { key: 'defineGoals', label: 'D√©finir objectifs pr√©cis', type: 'boolean' },
      { key: 'suggestProgram', label: 'Recommander programme adapt√©', type: 'boolean' },
      { key: 'offerPersonalTrainer', label: 'Proposer coach personnel', type: 'boolean' },
      { key: 'nutritionSupport', label: 'Mentionner conseils nutrition', type: 'boolean' }
    ]
  }
];

async function seedBusinessCategories() {
  console.log('üå± D√©but du peuplement des configurations m√©tiers...');

  for (const config of businessCategories) {
    try {
      const existing = await prisma.businessCategoryConfig.findUnique({
        where: { category: config.category as any }
      });

      if (existing) {
        console.log(`‚ö†Ô∏è  Configuration ${config.displayName} existe d√©j√† - mise √† jour...`);
        await prisma.businessCategoryConfig.update({
          where: { category: config.category as any },
          data: {
            displayName: config.displayName,
            systemPrompt: config.systemPrompt,
            defaultParams: config.defaultParams,
            availableOptions: config.availableOptions,
            updatedAt: new Date()
          }
        });
      } else {
        console.log(`‚úÖ Cr√©ation configuration ${config.displayName}...`);
        await prisma.businessCategoryConfig.create({
          data: {
            category: config.category as any,
            displayName: config.displayName,
            systemPrompt: config.systemPrompt,
            defaultParams: config.defaultParams,
            availableOptions: config.availableOptions
          }
        });
      }
    } catch (error) {
      console.error(`‚ùå Erreur pour ${config.displayName}:`, error);
    }
  }

  console.log('üéâ Peuplement termin√© !');
}

// Ex√©cution
seedBusinessCategories()
  .then(() => {
    console.log('‚úÖ Script termin√© avec succ√®s');
    process.exit(0);
  })
  .catch((error) => {
    console.error('‚ùå Erreur script:', error);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });